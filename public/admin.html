<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Админ-панель — ИП Хрюкин Е.А.</title>
  <link rel="stylesheet" href="/styles.css" />
  <style>
    .admin-container { max-width: 1400px; margin: 0 auto; padding: 24px 16px; }
    .admin-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
    .admin-header h1 { margin: 0; }
    .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px; }
    .stat-card { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 16px; }
    .stat-card h3 { margin: 0 0 8px; font-size: 14px; color: var(--muted); }
    .stat-card .value { font-size: 32px; font-weight: 700; }
    .filters { display: flex; gap: 12px; margin-bottom: 16px; flex-wrap: wrap; }
    .filters select, .filters input { padding: 8px 12px; border: 1px solid var(--border); border-radius: 8px; background: var(--surface); color: var(--text); }
    .callbacks-table { width: 100%; border-collapse: collapse; background: var(--surface); border: 1px solid var(--border); border-radius: 12px; overflow: hidden; }
    .callbacks-table th { background: #1b2230; padding: 12px; text-align: left; font-weight: 600; }
    .callbacks-table td { padding: 12px; border-top: 1px solid var(--border); }
    .callbacks-table tr:hover { background: #1b2230; }
    .status-badge { display: inline-block; padding: 4px 8px; border-radius: 6px; font-size: 12px; font-weight: 600; }
    .status-new { background: #2f7dff; color: #fff; }
    .status-in_progress { background: #f59e0b; color: #fff; }
    .status-completed { background: #1bbf72; color: #fff; }
    .status-cancelled { background: #6b7280; color: #fff; }
    .actions-cell { display: flex; gap: 8px; }
    .btn-small { padding: 6px 12px; font-size: 14px; }
    .modal-content { max-width: 600px; }
    .modal-content .field { margin-bottom: 16px; }
    .file-link { color: var(--primary); text-decoration: underline; }
  </style>
  <script defer src="/admin.js"></script>
</head>
<body>
  <div class="admin-container">
    <div class="admin-header">
      <h1>Админ-панель — Заявки</h1>
      <div class="actions">
        <a href="/" class="btn btn-secondary">На сайт</a>
        <button class="btn btn-primary" onclick="exportCSV()">Экспорт CSV</button>
        <button class="btn btn-secondary" onclick="loadCallbacks()">Обновить</button>
      </div>
    </div>

    <div class="stats">
      <div class="stat-card">
        <h3>Всего заявок</h3>
        <div class="value" id="stat-total">0</div>
      </div>
      <div class="stat-card">
        <h3>Новые</h3>
        <div class="value" id="stat-new">0</div>
      </div>
      <div class="stat-card">
        <h3>В работе</h3>
        <div class="value" id="stat-in-progress">0</div>
      </div>
      <div class="stat-card">
        <h3>Завершено</h3>
        <div class="value" id="stat-completed">0</div>
      </div>
    </div>

    <div class="filters">
      <select id="filter-status" onchange="applyFilters()">
        <option value="">Все статусы</option>
        <option value="new">Новые</option>
        <option value="in_progress">В работе</option>
        <option value="completed">Завершено</option>
        <option value="cancelled">Отменено</option>
      </select>
      <input type="text" id="filter-search" placeholder="Поиск по имени, телефону..." oninput="applyFilters()" />
    </div>

    <div style="overflow-x: auto;">
      <table class="callbacks-table">
        <thead>
          <tr>
            <th>Дата</th>
            <th>Имя</th>
            <th>Телефон</th>
            <th>Email</th>
            <th>Тип продукции</th>
            <th>Комментарий</th>
            <th>Файл</th>
            <th>Статус</th>
            <th>Действия</th>
          </tr>
        </thead>
        <tbody id="callbacks-tbody">
          <tr><td colspan="9" style="text-align: center; padding: 24px;">Загрузка...</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <dialog id="edit-modal" class="modal">
    <div class="modal-content">
      <h3>Редактировать заявку</h3>
      <form id="edit-form">
        <input type="hidden" id="edit-id" />
        <div class="field">
          <label>Статус</label>
          <select id="edit-status" class="input" required>
            <option value="new">Новая</option>
            <option value="in_progress">В работе</option>
            <option value="completed">Завершено</option>
            <option value="cancelled">Отменено</option>
          </select>
        </div>
        <div class="field">
          <label>Примечание</label>
          <textarea id="edit-note" class="textarea" rows="3"></textarea>
        </div>
        <div class="actions">
          <button type="submit" class="btn btn-primary">Сохранить</button>
          <button type="button" class="btn" onclick="document.getElementById('edit-modal').close()">Отмена</button>
        </div>
      </form>
    </div>
  </dialog>
</body>
</html>

